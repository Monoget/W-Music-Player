const mp3FilesIndex = [
    {name: "Karm hai tu moksh hai tu", path: "assets/music/Karm hai tu moksh hai tu.mp3"},
    {name: "Ram Siya Ram Lofi Version", path: "assets/music/Ram Siya Ram Lofi Version.mp3"},
    {name: "Sachet Parampara Shiv Tandav Stotram", path: "assets/music/Sachet Parampara  Shiv Tandav Stotram.mp3"}
];

const mp3FilesLatest = [
    {
        name: "IM- Ayigirinandini Dasaraspl - VeenaSrivani",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Ayigirinandini Dasaraspl VeenaSrivani.mp3"
    },
    {
        name: "IM- Raag hameer on the sitar - Nandita",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.Raag hameer on the sitar _ Nandita.mp3"
    },
    {
        name: "IM- Raga Jhinjhoti - Niladri Kumar",
        path: "IM- assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.Raga_Jhinjhoti_-_Niladri_Kumar.mp3"
    },
    {
        name: "IM- Raga Malhar Sitar - Niladri Kumar",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.Raga_Malhar_Sitar_-_Niladri_Kumar(128k).mp3"
    },
    {
        name: "IM- Sandhya Raga by Ravi Shankar students",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.Sandhya Raga by Ravi Shankar students.mp3"
    },
    {
        name: "IM- shivatandavasthotram - veenasrivani",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.shivatandavasthotram veenasrivani .mp3"
    },
    {
        name: "IM- Veena - World Record",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Instrumental Music/Music.Veena_-_World_Record.mp3"
    },
    {
        name: "Brodha V - Aathma Raama",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! Brodha V - Aathma Raama [Music Video] (256 kbps).mp3"
    },
    {
        name: "Brodha V - AIGIRI NANDINI [Hip Hop Version]",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! Brodha V - AIGIRI NANDINI [Hip Hop Version] (320 kbps).mp3"
    },
    {
        name: "HARE KRISHNA - Fakira",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! HARE KRISHNA - Fakira(MP3_320K).mp3"
    },
    {
        name: "Ram Siya Ram (Full Song)",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! Ram Siya Ram (Full Song) Sachet Tandon Poonam Thakkar Shabbir Ahmed Sidhika Sharma T-Series (256 kbps).mp3"
    },
    {
        name: "Shiv tandav stotram - Baahubali The Beginning",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! Shiv tandav stotram _ Baahubali The Beginning .mp3"
    },
    {
        name: "আগমনী - একি রণ বাজা বাজে - Eki Rono Baja Baje ",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! আগমনী - একি রণ বাজা বাজে - Eki Rono Baja Baje - শাস্ত্রপৃষ্ঠা (320 kbps).mp3"
    },
    {
        name: "কে কোথায় আমি - Arijit Singh",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! কে_কোথায়_আমি__Arijit_Singh_(128k).mp3"
    },
    {
        name: "দেখো আলোয় আলোয় আকাশ (অসতো মা সদ্গময়) by Arijit Singh",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! দেখো আলোয় আলোয় আকাশ (অসতো মা সদ্গময়) by Arijit Singh (320 kbps).mp3"
    },
    {
        name: "বেঙ্কটাচল নিলয়ম্ by Vijay Prakash",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! বেঙ্কটাচল নিলয়ম্ by Vijay Prakash (256 kbps).mp3"
    },
    {
        name: "ভ্রমর কইয়ো গিয়া - sneha saregama",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! ভ্রমর_কইয়ো_গিয়া - sneha _sa_re_ga(256k).mp3"
    },
    {
        name: "শিবোহম্ শিবোহম্ - Ponniyin Selvan Part 2",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! শিবোহম্ শিবোহম্ _ Ponniyin Selvan Part 2  _ Mani Ratnam  _ Sathyaprakash(MP3_160K).mp3"
    },
    {
        name: "Slowed Reverb Song",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/! শ্রীকৃষ্ণ গোবিন্দ হরে মুরারি _ [ slowed _ reverb .mp3"
    },
    {
        name: "Draupadi Songs Soundtracks",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Draupadi Songs Draupadi All Sound tracks with lyrics Mahabharat Starplus Panchali star plus (256 kbps).mp3"
    },
    {
        name: "Hindu Chalisha - KALKI Samman",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Hindu chalisha KALKI Samman Hindu Dharm Ki (320 kbps).mp3"
    },
    {
        name: "Itni Shakti Hamein Dena Data",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Itni Shakti Hamein Dena Data Vineet Dhingra Ankush Sushma Shreshtha Pushpa Pagdhare Cover (256 kbps).mp3"
    },
    {
        name: "Jai Mahakaali Maakaali",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Jai Mahakaali Maakaali (256 kbps).mp3"
    },
    {
        name: "Karam Ki Talwar Music Video",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Karam Ki Talwar Music Video _ Arjun _ The Warrior Prince _ Sukhwinder Singh _ UTV Motion Pictures(MP3_128K).mp3"
    },
    {
        name: "Karm hai tu moksh hai tu",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Karm hai tu moksh hai tu Sound Track (320 kbps).mp3"
    },
    {
        name: "Ganesh Song - Lambodra",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Lambodra lambodra Song From Vighnaharta Ganesh Ganesh Song From Vighnaharta Ganesh (320 kbps).mp3"
    },
    {
        name: "Madhura Murati Manohara",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Lord Shiva Song Madhura Murati Manohara Ati - মধুর মুরতি মনোহর অতি (256 kbps).mp3"
    },
    {
        name: "LUV KUSH VOL.1",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/LUV KUSH VOL.1 DEVOTIONAL HINDI MOVIE SONGS I AUDIO JUKE BOX (256 kbps).mp3"
    },
    {
        name: "Mahabharat All Songs",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Mahabharat All songs (256 kbps).mp3"
    },
    {
        name: "Sati Se Parvati Tak Ka Safar",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Mahakaali new Song Sati Se Parvati Tak Ka Safar Shiv Shakti Se Hi Poorn Hai Full Song (256 kbps).mp3"
    },
    {
        name: "Mahakaali Title Song",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Mahakaali title song_Mahakaali action _Mahakaali bengali_Mahakaali tandav (320 kbps).mp3"
    },
    {
        name: "Ram Siya Ram - Sachet Tandon",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Ram Siya Ram - Sachet Tandon.mp3"
    },
    {
        name: "Ram Siya Ram Lofi Version",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Ram Siya Ram Lofi Version Mangal Bhavan Amangal Hari (256 kbps).mp3"
    },
    {
        name: "Radha Rani Rajyabhishek Theme",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Rkrishn soundtracks 66 - Radha Rani Rajyabhishek Theme (320 kbps).mp3"
    },
    {
        name: "Kaal Bhairav Ashtakam",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Sachet Parampara - Kaal Bhairav Ashtakam -(MP3_320K).mp3"
    },
    {
        name: "Shiv Tandav Stotram",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Sachet Parampara - Shiv Tandav Stotram (Har Har Shiv.mp3"
    },
    {
        name: "Yasomati Maiya x Ram Siya Ram",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Sachet Parampara - Yasomati Maiya Ram Siya Ram.mp3"
    },
    {
        name: "Krishna Ji Song Collection",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Sachet Parampara All Shri Krishna Songs Collection _ Krishna Ji Song _TuneLyrico(MP3_320K).mp3"
    },
    {
        name: "Shyama Aan Baso Vrindavan",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Sachet Parampara Shyama Aan Baso Vrindavan Full Song _ Arre Dwaarpalon _ Tune Lyrico(MP3_320K).mp3"
    },
    {
        name: "Shri Ram - Epic Warrior 2",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/Shri Ram - Epic Warrior 2 - Armonian (320 kbps).mp3"
    },
    {
        name: "Atma Rama Anand Ramana",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/आत्मा रामा - रग रग में राम Atma Rama Anand Ramana.mp3"
    },
    {
        name: "पता नहीं किस रूप में आकर नारायण मिल जाएगा चेतावनी भजन प्रकाश गाँधी PMC संत संदेश",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/पता नहीं किस रूप में आकर नारायण मिल जाएगा चेतावनी भजन प्रकाश गाँधी PMC संत संदेश New Bhajan (256 kbps).mp3"
    },
    {
        name: "भजन तेरे नाम का सुमिरन करके मेरे मन में सुख भर आया II आर्य समाज वैदिक भजन II",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/भजन तेरे नाम का सुमिरन करके मेरे मन में सुख भर आया II आर्य समाज वैदिक भजन II (256 kbps).mp3"
    },
    {
        name: "भजन हे ज्ञानवान भगवन हमको भी ज्ञान दे दो II आर्य समाज वैदिक भजन II",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/भजन हे ज्ञानवान भगवन हमको भी ज्ञान दे दो II आर्य समाज वैदिक भजन II (256 kbps).mp3"
    },
    {
        name: "অচ্যুতম কেশবম্ by Alka Yagnik",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/অচ্যুতম কেশবম্ by Alka Yagnik (256 kbps).mp3"
    },
    {
        name: "গণরাজ (গণপতি) _ Bajirao Mastani",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/গণরাজ (গণপতি) _ Bajirao Mastani .mp3"
    },
    {
        name: "Maha Shivaratri - In Presence of Sadhguru",
        path: "assets/music/আধুনিক ফিউশন ও অন্যান্য/মহানির্বাণ ষটকম্ In Presence of Sadhguru Maha Shivaratri Isha Yoga Centre (128 kbps).mp3"
    }
];

const mp3FilesKrishna = [
    {name: "Latest Track 1", path: "assets/music/Latest Track 1.mp3"},
    {name: "Latest Track 2", path: "assets/music/Latest Track 2.mp3"}
];

const mp3FilesClassic = [
    {name: "Latest Track 1", path: "assets/music/Latest Track 1.mp3"},
    {name: "Latest Track 2", path: "assets/music/Latest Track 2.mp3"}
];

const mp3FilesBromho = [
    {name: "Latest Track 1", path: "assets/music/Latest Track 1.mp3"},
    {name: "Latest Track 2", path: "assets/music/Latest Track 2.mp3"}
];

const mp3FilesMontro = [
    {name: "Latest Track 1", path: "assets/music/Latest Track 1.mp3"},
    {name: "Latest Track 2", path: "assets/music/Latest Track 2.mp3"}
];

const mp3FilesMatri = [
    {name: "Latest Track 1", path: "assets/music/Latest Track 1.mp3"},
    {name: "Latest Track 2", path: "assets/music/Latest Track 2.mp3"}
];

const mp3FilesNew = [
    {name: "Sachet Parampara Shiv Tandav Stotram", path: "assets/music/Sachet Parampara  Shiv Tandav Stotram.mp3"}
];

$(document).ready(function () {
    const playlist = $('#playlist');
    const audioPlayer = $('#audioPlayer')[0];
    const albumCover = $('#albumCover');
    const playPauseBtn = $('#playPauseBtn');
    const seekBar = $('#seekBar');
    const volumeBar = $('#volumeBar');
    const currentTimeLabel = $('#currentTime');
    const totalTimeLabel = $('#totalTime');
    const volumeIcon = document.getElementById('volumeIcon');
    // Get references to the button and slider elements
    const volumeButton = document.getElementById('volumeButton');
    const slider = document.getElementById('volumeSlider');

    let isPlaying = false;

    audioPlayer.volume = volumeBar.val() / 100;

    // Load the appropriate playlist based on the current page
    let currentPlaylist = [];

    // Load the appropriate playlist based on the current page
    const currentPage = window.location.pathname.split('/').pop(); // Get the current page name
    if (currentPage === 'index.html') {
        currentPlaylist = mp3FilesIndex;
    } else if (currentPage === 'latest.html') {
        currentPlaylist = mp3FilesLatest;
    } else if (currentPage === 'krishna.html') {
        currentPlaylist = mp3FilesKrishna;
    } else if (currentPage === 'classic.html') {
        currentPlaylist = mp3FilesClassic;
    } else if (currentPage === 'bromho.html') {
        currentPlaylist = mp3FilesBromho;
    } else if (currentPage === 'montro.html') {
        currentPlaylist = mp3FilesMontro;
    } else if (currentPage === 'matri.html') {
        currentPlaylist = mp3FilesMatri;
    } else if (currentPage === 'new.html') {
        currentPlaylist = mp3FilesNew;
    }

    // Load the playlist into the UI
    loadPlaylist(currentPlaylist);

    // Search functionality
    document.getElementById('searchBox').addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const filteredFiles = currentPlaylist.filter(file => file.name.toLowerCase().includes(query));
        loadPlaylist(filteredFiles);
    });

    // Load the playlist
    function loadPlaylist(files) {
        playlist.empty();
        files.forEach(file => {
            const playlistItem = $('<div></div>').addClass('playlist-item').text(file.name);
            playlistItem.data('src', file.path);

            // Click event to play the song
            playlistItem.on('click', function () {
                $('.playlist-item').removeClass('active-song');
                $(this).addClass('active-song');
                audioPlayer.src = $(this).data('src');
                audioPlayer.play();
                isPlaying = true;
                updatePlayPauseIcon();
                fetchAlbumArt($(this).data('src'));
            });

            playlist.append(playlistItem);
        });
    }

    // Fetch album art from the MP3 file using AJAX
    function fetchAlbumArt(src) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', src, true);
        xhr.responseType = 'blob';
        xhr.onload = function () {
            if (xhr.status === 200) {
                const fileBlob = xhr.response;
                jsmediatags.read(fileBlob, {
                    onSuccess: function (tag) {
                        const albumArt = tag.tags.picture;
                        if (albumArt) {
                            const base64String = arrayBufferToBase64(albumArt.data);
                            albumCover.attr('src', 'data:' + albumArt.format + ';base64,' + base64String);
                        } else {
                            albumCover.attr('src', 'assets/images/default-cover.jpg');
                        }
                    },
                    onError: function (error) {
                        console.error('Error reading tags:', error);
                        albumCover.attr('src', 'assets/images/default-cover.jpg');
                    }
                });
            } else {
                console.error('Failed to fetch file:', xhr.status);
                albumCover.attr('src', 'assets/images/default-cover.jpg');
            }
        };
        xhr.onerror = function () {
            console.error('Error fetching file.');
            albumCover.attr('src', 'assets/images/default-cover.jpg');
        };
        xhr.send();
    }

    // Play/pause button
    playPauseBtn.on('click', function () {
        if (isPlaying) {
            audioPlayer.pause();
        } else {
            audioPlayer.play();
        }
        isPlaying = !isPlaying;
        updatePlayPauseIcon();
    });

    // Update play/pause button icon
    function updatePlayPauseIcon() {
        if (isPlaying) {
            playPauseBtn.html('<i class="fas fa-pause"></i>');
        } else {
            playPauseBtn.html('<i class="fas fa-play"></i>');
        }
    }

    // Update the seek bar and time
    audioPlayer.addEventListener('timeupdate', function () {
        const currentTime = audioPlayer.currentTime;
        const duration = audioPlayer.duration;

        seekBar.val((currentTime / duration) * 100);
        currentTimeLabel.text(formatTime(currentTime));
        totalTimeLabel.text(formatTime(duration));
    });

    // Seek bar change
    seekBar.on('input', function () {
        const seekTo = (audioPlayer.duration / 100) * seekBar.val();
        audioPlayer.currentTime = seekTo;
    });

    // Volume control
    volumeBar.on('input', function () {
        audioPlayer.volume = volumeBar.val() / 100;

        // Change the icon based on the volume level
        updateVolumeIcon(volumeBar.val());
    });

    // Format time (in seconds) to mm:ss
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function updateVolumeIcon(volumeLevel) {
        if (volumeLevel == 0) {
            volumeIcon.className = 'fa-solid fa-volume-mute'; // Mute icon
        } else if (volumeLevel <= 33) {
            volumeIcon.className = 'fa-solid fa-volume-off'; // Low volume icon
        } else if (volumeLevel <= 66) {
            volumeIcon.className = 'fa-solid fa-volume-low'; // Medium volume icon
        } else {
            volumeIcon.className = 'fa-solid fa-volume-high'; // High volume icon
        }
    }

    // Toggle the slider display when the button is clicked
    volumeButton.addEventListener('click', function (event) {
        event.stopPropagation(); // Prevent the click from bubbling up to the document
        if (slider.style.display === 'none' || slider.style.display === '') {
            slider.style.display = 'block'; // Show the slider
        } else {
            slider.style.display = 'none'; // Hide the slider
        }
    });

    // Hide the slider when clicking anywhere else on the document
    document.addEventListener('click', function (event) {
        if (slider.style.display === 'block') {
            // Check if the click is outside the button and the slider
            if (!volumeButton.contains(event.target) && !slider.contains(event.target)) {
                slider.style.display = 'none'; // Hide the slider
            }
        }
    });
});

function arrayBufferToBase64(buffer) {
    let binary = '';
    const bytes = new Uint8Array(buffer);
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}

